((function(){var a,b,c,d,e;requirejs(["sketch.min","TweenLite.min","easing/EasePack.min","dat.gui.min"],function(a){return console.log("requirejs loaded"),e()}),e=function(){var e;return e=Sketch.create({down:!1,pendulums:null,triggers:null,presets:null,currentPreset:null,frameCount:null,freq:null,preset:null,volume:null,restart:null,audioContext:null,gain:null,NUM_PENDULUMS:24,OFFSET:45,container:document.getElementById("container"),setup:function(){return this.frameCount=0,this.volume=1,this.freq=7/60,this.initAudio(),this.initPresets(),this.initTriggers(),this.initPendulums(),this.initGUI()},update:function(){var a,b,c,d,f,g,h,i,j;c=this.frameCount+=1/60,i=this.pendulums;for(d=0,g=i.length;d<g;d++)a=i[d],a.freq=this.freq,a.update(c),a.pos.x=floor((e.width-(this.NUM_PENDULUMS-1)*this.OFFSET)*.5)+a.index*this.OFFSET,a.pos.y+=e.height*.5;j=this.triggers;for(f=0,h=j.length;f<h;f++)b=j[f],b.update(),b.pos.x=floor((e.width-(this.NUM_PENDULUMS-1)*this.OFFSET)*.5)+b.index*this.OFFSET,b.pos.y=e.height*.5;return this.gain.gain.value=this.volume},draw:function(){var a,b,c,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s;e.lineWidth=1,e.moveTo(0,e.height*.5),e.lineTo(e.width,e.height*.5),e.strokeStyle="rgb(40, 40, 40)",e.stroke(),p=this.triggers;for(j=0,n=p.length;j<n;j++)i=p[j],i.draw();e.globalCompositeOperation="lighter",e.lineWidth=1;for(d=k=0,q=this.NUM_PENDULUMS;0<=q?k<q:k>q;d=0<=q?++k:--k){h=this.pendulums[d],c=80;for(f=l=0;l<5;f=++l)d>f&&(g=this.pendulums[d-(f+1)],g.direction===h.direction&&(c=120),b=min(Math.abs(h.pos.y-g.pos.y),100),a=1-b/100,e.beginPath(),e.moveTo(h.pos.x,h.pos.y),e.lineTo(g.pos.x,g.pos.y),e.strokeStyle="rgba("+c+", "+c+", "+c+", "+a+")",e.stroke())}r=this.pendulums,s=[];for(m=0,o=r.length;m<o;m++)h=r[m],s.push(h.draw());return s},mousedown:function(){var a,b,c,f,g,h,i,j;this.down=!0,this.audioContext.resume(),i=this.triggers,j=[];for(g=0,h=i.length;g<h;g++){f=i[g],b=e.mouse.x-f.pos.x,c=e.mouse.y-f.pos.y,a=b*b+c*c;if(a>d.HIT_RADIUS_SQ)continue;j.push(f.mousedown())}return j},mouseup:function(){return this.down=!1},mousemove:function(){var a,b,c,f,g,h,i,j;if(!this.triggers)return;i=this.triggers,j=[];for(g=0,h=i.length;g<h;g++)f=i[g],b=e.mouse.x-f.pos.x,c=e.mouse.y-f.pos.y,a=b*b+c*c,a<d.HIT_RADIUS_SQ?j.push(f.mouseover()):f.over?j.push(f.mouseout()):j.push(void 0);return j},initAudio:function(){var a;return a=window.AudioContext||window.webkitAudioContext,this.audioContext=new a,this.gain=this.audioContext.createGain(),this.gain.connect(this.audioContext.destination)},initPresets:function(){var a,b;this.presets=[],this.presets.push(new c("preset 1",this.presets.length,7/60,[2,1,1,1,2,1,3,1,2,1,1,1,2,1,1,1,2,1,3,1,2,1,1,1])),this.presets.push(new c("preset 2",this.presets.length,13/60,[0,0,2,0,5,3,3,3,2,2,0,2,0,0,2,0,0,0,3,3,0,0,0,0])),this.currentPreset=this.presets[0],a=this.getParam("p"),a&&(b=this.decodePreset(a));if(b)return this.presets.push(b),this.currentPreset=b,this.preset=b.index},initTriggers:function(){var a,c,f,g,h,i,j,k;this.triggers=[],k=[];for(a=i=0,j=this.NUM_PENDULUMS;0<=j?i<j:i>j;a=0<=j?++i:--i)f=new b(a*this.OFFSET,0),h=this.currentPreset.types[a],a>this.NUM_PENDULUMS*.5?c=pow((a-this.NUM_PENDULUMS)/12,2)+1:c=pow(a/12,2)+1,g=new d(e,this.audioContext,this.gain,a,f,h,c),k.push(this.triggers.push(g));return k},initPendulums:function(){var c,d,f,g,h,i,j;this.pendulums=[],this.freq=this.currentPreset.freq,j=[];for(c=h=0,i=this.NUM_PENDULUMS;0<=i?h<i:h>i;c=0<=i?++h:--h)f=new b(c*this.OFFSET,0),g=this.triggers[c],d=new a(e,c,f,this.freq,1*c,g),j.push(this.pendulums.push(d));return j},initGUI:function(){var a,b,c,d,e,f,g=this;this.restart=function(){return this.frameCount=0,this.update()},this.save=function(){var a,b,c,d,e;b=!1,this.url="http://www.brunoimbrizi.com/experiments/#/06?p="+this.encodePreset(),e=this.gui.__controllers;for(c=0,d=e.length;c<d;c++){a=e[c];if(a.property==="url"){a.setValue(this.url),a.updateDisplay(),b=!0;break}}return b||(a=this.gui.add(this,"url")),a.domElement.firstChild.focus(),a.domElement.firstChild.select()},c={},f=this.presets;for(d=0,e=f.length;d<e;d++)b=f[d],c[b.name]=b.index;return a=new dat.GUI,a.add(this,"preset",c).onChange(function(a){var b,c,d,e,f;g.currentPreset=g.presets[a],g.freq=g.currentPreset.freq,f=[];for(b=d=0,e=g.NUM_PENDULUMS;0<=e?d<e:d>e;b=0<=e?++d:--d)c=g.triggers[b],f.push(c.loadSound(g.currentPreset.types[b]));return f}).name("presets"),a.add(this,"freq").min(1/60).max(1).step(1/60).listen(),a.add(this,"volume").min(0).max(1),a.add(this,"restart"),a.add(this,"save").name("save"),this.gui=a},getParam:function(a){var b,c,d;return a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),c="[\\?&]"+a+"=([^&#]*)",b=new RegExp(c),d=b.exec(window.location.search),d?decodeURIComponent(d[1].replace(/\+/g," ")):""},encodePreset:function(){var a,b,c,d,e;a="",a+=this.freq+",",e=this.triggers;for(c=0,d=e.length;c<d;c++)b=e[c],a+=b.type+",";return a=a.substr(0,a.length-1),a},decodePreset:function(a){var b,d,e,f,g,h,i;e=a.indexOf(","),b=parseFloat(a.substring(0,e)),b=max(b,0),b=min(b,1),g=a.substring(e+1).split(",");for(d=h=0,i=this.NUM_PENDULUMS;0<=i?h<i:h>i;d=0<=i?++h:--h)g[d]?(f=floor(g[d]),f=max(f,0),f=min(f,5),g[d]=f):g[d]=0;return new c("from url",this.presets.length,b,g)}})},a=function(){function a(a,b,c,d,e,f){this.ctx=a,this.index=b,this.pos=c,this.freq=d,this.delay=e,this.trigger=f,this.color="rgb(200, 200, 200)",this.radius=4}return a.prototype.ctx=null,a.prototype.trigger=null,a.prototype.index=null,a.prototype.pos=null,a.prototype.oldY=null,a.prototype.radius=null,a.prototype.color=null,a.prototype.delay=null,a.prototype.freq=null,a.prototype.oldFreq=null,a.prototype.direction=null,a.prototype.AMPLITUDE=100,a.prototype.update=function(a){if(a<this.delay)return;return this.pos.y=sin(this.freq*(a-this.delay)*TWO_PI)*this.AMPLITUDE,this.direction=this.pos.y>this.oldY,this.freq===this.oldFreq&&this.oldY*this.pos.y<0&&this.trigger.fire(),this.oldY=this.pos.y,this.oldFreq=this.freq},a.prototype.draw=function(){return this.ctx.translate(this.pos.x,this.pos.y),this.ctx.beginPath(),this.ctx.arc(0,0,this.radius,0,TWO_PI),this.ctx.fillStyle=this.color,this.ctx.fill(),this.ctx.closePath(),this.ctx.setTransform(1,0,0,1,0,0)},a}(),b=function(){function a(a,b){this.x=a,this.y=b}return a.prototype.x=null,a.prototype.y=null,a.prototype.distanceTo=function(a){var b,c;return b=this.x-a.x,c=this.y-a.y,sqrt(b*b+c*c)},a}(),c=function(){function a(a,b,c,d){this.name=a,this.index=b,this.freq=c,this.types=d}return a.prototype.freq=null,a.prototype.types=null,a.prototype.index=null,a.prototype.name=null,a}(),d=function(){function a(a,b,c,d,e,f,g){this.ctxCanvas=a,this.ctxAudio=b,this.gain=c,this.index=d,this.pos=e,this.type=f,this.pitch=g,this.radius=2,this.color="rgb(40, 40, 40)",this.fired=!1,this.blast={radius:3,alpha:1,lineWidth:1,color:null},this.hover={radius:0},this.loadSound(this.type)}return a.prototype.ctxCanvas=null,a.prototype.ctxAudio=null,a.prototype.index=null,a.prototype.type=null,a.prototype.pos=null,a.prototype.radius=null,a.prototype.color=null,a.prototype.fired=null,a.prototype.blast=null,a.prototype.hover=null,a.prototype.buffer=null,a.prototype.sound=null,a.prototype.pitch=null,a.prototype.gain=null,a.prototype.wetGain=null,a.prototype.flange=null,a.prototype.over=null,a.TYPE_OFF=0,a.TYPE_SHAKER=1,a.TYPE_HIHAT=2,a.TYPE_KICK=3,a.TYPE_BLOCK=4,a.TYPE_CLAP=5,a.prototype.SOUND_SHAKER="shaker",a.prototype.SOUND_HIHAT="hihat",a.prototype.SOUND_KICK="kick",a.prototype.SOUND_BLOCK="block",a.prototype.SOUND_CLAP="clap",a.HIT_RADIUS_SQ=100,a.prototype.update=function(){},a.prototype.draw=function(){return this.ctxCanvas.translate(this.pos.x,this.pos.y),this.ctxCanvas.beginPath(),this.ctxCanvas.arc(0,0,this.hover.radius,0,TWO_PI),this.ctxCanvas.fillStyle="rgba("+this.blast.color+", 0.8)",this.ctxCanvas.fill(),this.ctxCanvas.closePath(),this.ctxCanvas.beginPath(),this.ctxCanvas.arc(0,0,this.blast.radius,0,TWO_PI),this.ctxCanvas.lineWidth=this.blast.lineWidth,this.ctxCanvas.strokeStyle="rgba("+this.blast.color+","+this.blast.alpha+")",this.ctxCanvas.stroke(),this.ctxCanvas.closePath(),this.ctxCanvas.beginPath(),this.ctxCanvas.arc(0,0,this.radius,0,TWO_PI),this.ctxCanvas.fillStyle=this.color,this.ctxCanvas.fill(),this.ctxCanvas.closePath(),this.ctxCanvas.setTransform(1,0,0,1,0,0)},a.prototype.mousedown=function(){return this.type<5?this.loadSound(this.type+1):this.loadSound(0)},a.prototype.mouseover=function(){if(this.over)return;return this.over=!0,TweenLite.to(this.hover,.2,{radius:12,ease:Quart.easeOut})},a.prototype.mouseout=function(){if(!this.over)return;return this.over=!1,TweenLite.to(this.hover,.2,{radius:0,ease:Quart.easeOut})},a.prototype.fire=function(){var a=this;if(!this.type)return;return this.fired=!0,this.blast.radius=4,this.blast.alpha=.8,TweenLite.to(this.blast,.1,{radius:15,alpha:1,lineWidth:15,ease:Linear.easeOut,onComplete:function(){return TweenLite.to(a.blast,.5,{radius:3,lineWidth:1,ease:Quart.easeOut})}}),this.playSound()},a.prototype.loadSound=function(b){var c,d,e=this;this.type=b;switch(this.type){case a.TYPE_OFF:this.sound=null,this.blast.color="50, 50, 50";break;case a.TYPE_SHAKER:this.sound=this.SOUND_SHAKER,this.blast.color="50, 200, 220";break;case a.TYPE_HIHAT:this.sound=this.SOUND_HIHAT,this.blast.color="25, 100, 140";break;case a.TYPE_KICK:this.sound=this.SOUND_KICK,this.blast.color="140, 25, 55";break;case a.TYPE_BLOCK:this.sound=this.SOUND_BLOCK,this.blast.color="165, 165, 50";break;case a.TYPE_CLAP:this.sound=this.SOUND_CLAP,this.blast.color="80, 155, 45"}if(!this.ctxAudio)return;if(!this.sound)return;return d="sounds/"+this.sound+".ogg",c=new XMLHttpRequest,c.open("GET",d,!0),c.responseType="arraybuffer",c.onload=function(){return e.ctxAudio.decodeAudioData(c.response,function(a){return e.buffer=a})},c.send()},a.prototype.playSound=function(){var a;if(!this.ctxAudio)return;if(!this.buffer)return;return a=this.ctxAudio.createBufferSource(),a.buffer=this.buffer,a.connect(this.gain),a.playbackRate.value=this.pitch,a.start(0)},a}()})).call(this)