((function(){var a,b,c,d,e,f,g,h,i=function(a,b){return function(){return a.apply(b,arguments)}},j={}.hasOwnProperty,k=function(a,b){function d(){this.constructor=a}for(var c in b)j.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};a=function(){function a(){this.view=app.view,this.initGUI()}return a.prototype.view=null,a.prototype.drawImage=!1,a.prototype.lineWidthRandom=!0,a.prototype.lineWidthBrightness=!0,a.prototype.tint=!1,a.prototype.drawNegative=!1,a.prototype.threshold=100,a.prototype.lineWidth=5,a.prototype.scale=2,a.prototype.numCircles=80,a.prototype.numFrames=180,a.prototype.numSlices=60,a.prototype.easing="easeInCirc",a.prototype.image="william.jpg",a.prototype.color="#00cc25",a.prototype.redraw=null,a.prototype.initGUI=function(){var a,b,c;return this.redraw=function(){return this.view.redraw()},a=new dat.GUI({load:window.presets}),a.open(),a.remember(this),c=this,a.add(this,"tint"),a.addColor(this,"color"),a.add(this,"lineWidthRandom"),a.add(this,"lineWidthBrightness"),a.add(this,"lineWidth",1,10),a.add(this,"threshold",0,255),a.add(this,"scale",.5,5),a.add(this,"numCircles",10,100),a.add(this,"numFrames",10,540),a.add(this,"numSlices",5,120),a.add(this,"easing",["easeLinear","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","easeOutSine","easeInOutSine","easeInExpo","easeOutExpo","easeInOutExpo","easeInCirc","easeOutCirc","easeInOutCirc"]),a.add(this,"image").onChange(function(){return c.onImageChange()}),a.add(this,"redraw"),b=app.getParam("p"),b&&(a.preset=b),null},a.prototype.initStats=function(){return this.stats=new Stats,document.body.appendChild(this.stats.domElement),null},a.prototype.onImageChange=function(){return this.view.image.src="img/"+this.image,null},a}(),c=function(){function b(){this.redraw=i(this.redraw,this),this.initCircles=i(this.initCircles,this),this.initImage=i(this.initImage,this),this.initUI=i(this.initUI,this),this.initSketch=i(this.initSketch,this)}return b.prototype.sketch=null,b.prototype.img=null,b.prototype.circles=null,b.prototype.init=function(){return this.initSketch()},b.prototype.initSketch=function(){var a=this;return this.sketch=Sketch.create({type:Sketch.CANVAS,container:document.getElementById("container"),autoclear:!1}),this.sketch.setup=function(){return a.initImage(),a.initUI(),a.frameCount=0,null},this.sketch.update=function(){if(!a.iw)return;return a.frameCount++,null},this.sketch.draw=function(){var b,c,d,e,f,g,h,i,j,k,l,m;if(!a.iw)return;a.sketch.save(),a.sketch.translate(a.cx,a.cy),g=a.iw*.5,f=a.ih*.5,a.ui.drawImage&&a.sketch.drawImage(a.img,-g,-f),a.sketch.strokeStyle=a.ui.color,a.sketch.lineWidth=a.ui.lineWidth;if(a.frameCount<a.ui.numFrames){m=a.circles;for(k=0,l=m.length;k<l;k++){b=m[k],i=TWO_PI/a.ui.numSlices,e=a.frameCount*b.time,h=b.iniAngle+e*i,d=b.iniAngle+(e+1)*i,c=a.getColors(g+b.radius*cos(h),f+b.radius*sin(h));if(a.ui.drawNegative){if(c.gray>a.ui.threshold)continue}else if(c.gray<a.ui.threshold)continue;a.ui.tint||(a.sketch.strokeStyle="rgb("+c.r+","+c.g+","+c.b+")"),a.ui.lineWidthRandom?a.sketch.lineWidth=random(a.ui.lineWidth):a.ui.lineWidthBrightness&&(j=(255-a.ui.threshold)/a.ui.lineWidth,a.sketch.lineWidth=floor((c.gray-a.ui.threshold)/j)),a.sketch.beginPath(),a.sketch.arc(0,0,b.radius*a.ui.scale,h,d),a.sketch.stroke(),a.sketch.closePath()}}return a.sketch.restore(),null},this.sketch.resize=function(){return a.ix=floor((a.sketch.width-a.iw)*.5),a.iy=floor((a.sketch.height-a.ih)*.5),a.cx=floor(a.sketch.width*.5),a.cy=floor(a.sketch.height*.5),a.frameCount>a.ui.numFrames&&a.redraw(),null},this.sketch.keyup=function(a){return null},this.sketch.mousedown=function(){return null},this.sketch.mousemove=function(){return null},this.sketch.mouseup=function(){return null}},b.prototype.initUI=function(){return this.ui=new a,null},b.prototype.initImage=function(){var a=this;return this.image=new Image,this.image.onload=function(){return a.iw=a.image.width,a.ih=a.image.height,a.img=document.createElement("canvas"),a.img.width=a.iw,a.img.height=a.ih,a.img.ctx=a.img.getContext("2d"),a.img.ctx.drawImage(a.image,0,0),a.sketch.clear(),a.frameCount=0,a.initCircles(),a.setColors()},this.image.src="img/william.jpg",null},b.prototype.setColors=function(){var a,b,c,d,e;a=this.img.ctx.getImageData(0,0,this.img.width,this.img.height).data,d=this.img.width*this.img.height,b=0,this.colors=[];for(b=e=0;0<=d?e<d:e>d;b=0<=d?++e:--e)c={},c.r=a[4*b],c.g=a[4*b+1],c.b=a[4*b+2],c.gray=(c.r+c.g+c.b)/3,this.colors.push(c);return null},b.prototype.getColors=function(a,b){var c,d;return c={r:0,g:0,b:0,gray:0},a>this.img.width||a<0?c:b>this.img.height||b<0?c:(d=floor(b)*this.img.width+floor(a),d>this.colors.length?c:this.colors[d])},b.prototype.initCircles=function(){var a,b,c,d,e,f,g;this.circles=[],e=this.ui.numCircles;for(c=g=0;0<=e?g<e:g>e;c=0<=e?++g:--g)d=1,b=max(this.iw,this.ih)/2,f=Math[this.ui.easing](c,d,b,e),a={},a.iniAngle=random(TWO_PI),a.index=c,a.radius=f,a.angle=0,a.time=0,this.circles.push(a),TweenMax.to(a,3,{time:1,delay:random(),ease:Circ.easeOut});return null},b.prototype.redraw=function(){return this.sketch.clear(),this.frameCount=0,this.initCircles(),null},b}(),d=function(){function a(a,b,c){this.ctx=a,this.pos=b,this.type=c,this.color="#000",this.vel=new Vec3D,this.acc=new Vec3D,this.radius=4,this.maxSpeed=5,this.maxSteer=.1*this.maxSpeed,this.pathLastSegment=-1,this.wanderTheta=0,this.SEPARATION_RADIUS_SQ=this.SEPARATION_RADIUS*this.SEPARATION_RADIUS,this.ALIGNMENT_RADIUS_SQ=this.ALIGNMENT_RADIUS*this.ALIGNMENT_RADIUS,this.COHESION_RADIUS_SQ=this.COHESION_RADIUS*this.COHESION_RADIUS}return a.prototype.ctx=null,a.prototype.pos=null,a.prototype.vel=null,a.prototype.acc=null,a.prototype.radius=null,a.prototype.color=null,a.prototype.type=null,a.prototype.img=null,a.prototype.wrapped=null,a.prototype.maxSpeed=null,a.prototype.maxSteer=null,a.prototype.wanderTheta=null,a.prototype.arriveRadius=50,a.prototype.SEPARATION_RADIUS=30,a.prototype.ALIGNMENT_RADIUS=40,a.prototype.COHESION_RADIUS=60,a.prototype.SEPARATION_RADIUS_SQ=null,a.prototype.ALIGNMENT_RADIUS_SQ=null,a.prototype.COHESION_RADIUS_SQ=null,a.prototype.update=function(){return this.acc.limit(this.maxSteer),this.vel.addSelf(this.acc),this.vel.limit(this.maxSpeed),this.pos.addSelf(this.vel),this.acc.clear()},a.prototype.draw=function(){return this.ctx.beginPath(),this.ctx.arc(this.pos.x,this.pos.y,this.radius*.8,0,TWO_PI),this.ctx.fillStyle=this.color,this.ctx.fill(),this.ctx.closePath()},a.prototype.wrap=function(){var a,b;a=this.pos.x,b=this.pos.y,this.wrapped=!1,this.pos.x>this.ctx.width?this.pos.x=0:this.pos.x<0&&(this.pos.x=this.ctx.width),this.pos.y>this.ctx.height?this.pos.y=0:this.pos.y<0&&(this.pos.x=this.ctx.height);if(a!==this.pos.x||b!==this.pos.y)return this.wrapped=!0},a.prototype.bounce=function(){if(this.pos.x>this.ctx.width||this.pos.x<0)this.vel.x*=-1;if(this.pos.y>this.ctx.height||this.pos.y<0)return this.vel.y*=-1},a.prototype.respawn=function(){var a,b;a=this.pos.x,b=this.pos.y,this.wrapped=!1,this.pos.x>this.ctx.width?this.pos.x=0:this.pos.x<0&&(this.pos.x=0),this.pos.y>this.ctx.height?this.pos.x=0:this.pos.y<0&&(this.pos.x=0);if(a!==this.pos.x||b!==this.pos.y)return this.wrapped=!0},a.prototype.seek=function(a){var b;return b=new Vec3D,b=a.sub(this.pos),b.limit(this.maxSteer),b},a.prototype.flee=function(a){var b;return Vec3D(b),b=this.pos.sub(a),b.limit(this.maxSteer),b},a.prototype.arrive=function(a){var b,c,d,e,f;return b=a.sub(this.pos),c=b.magnitude(),c>this.arriveRadius?e=this.maxSpeed:e=this.maxSpeed*c/this.arriveRadius,f=b,f.normalizeTo(e),d=f.sub(this.vel),d.limit(this.maxSteer),d},a.prototype.pursue=function(a){var b,c,d,e,f,g;return b=a.pos.sub(this.pos),c=b.magnitude(),f=this.vel.magnitude(),f<=c?e=1:e=c/f,d=a.vel.scale(e),g=a.pos.add(d),this.arrive(g)},a.prototype.evade=function(a){var b,c,d,e,f,g;return b=a.pos.sub(this.pos),c=b.magnitude(),f=this.vel.magnitude(),f<=c?e=1:e=c/f,d=a.vel.scale(e),g=a.pos.add(d),this.flee(g)},a.prototype.wander=function(){var a,b,c,d;return b=60,c=16,d=.25,this.wanderTheta+=random(-d,d),a=this.vel.copy().normalizeTo(b),a.addSelf(new Vec3D(cos(this.wanderTheta)*c,sin(this.wanderTheta)*c,0)),a.addSelf(this.pos),this.seek(a)},a.prototype.separate=function(a){var b,c,d,e,f,g,h;f=new Vec3D,c=0;for(g=0,h=a.length;g<h;g++){b=a[g];if(this===b)continue;d=this.pos.distanceTo(b.pos),d>0&&d<=this.SEPARATION_RADIUS&&(e=this.pos.sub(b.pos),e.normalizeTo(1/d),f.addSelf(e),c++)}return c>0&&f.scaleSelf(1/c),f},a.prototype.align=function(a){var b,c,d,e,f,g;e=new Vec3D,c=0;for(f=0,g=a.length;f<g;f++){b=a[f];if(this===b)continue;d=this.pos.distanceToSquared(b.pos),d>0&&d<=this.ALIGNMENT_RADIUS_SQ&&(e.addSelf(b.vel),c++)}return c>0&&e.scaleSelf(1/c),e},a.prototype.cohesion=function(a){var b,c,d,e,f,g,h;b=new Vec3D,d=0;for(g=0,h=a.length;g<h;g++){c=a[g];if(this===c)continue;e=this.pos.distanceToSquared(c.pos),e>0&&e<=this.COHESION_RADIUS_SQ&&(b.addSelf(c.pos),d++)}return d>0&&b.scaleSelf(1/d),f=b.sub(this.pos),f},a}(),g=function(a){function b(a,c,d){b.__super__.constructor.call(this,a,c,d),this.DISTANCE_SQ=this.DISTANCE*this.DISTANCE,this.particles=[],this.initParticles()}return k(b,a),b.prototype.particles=null,b.prototype.NUM_PARTICLES=10,b.prototype.DISTANCE=20,b.prototype.DISTANCE_SQ=null,b.prototype.DAMP=.9,b.prototype.update=function(){var a,c,d,e,f,g,h,i,j,k,l,m,n,o,p;b.__super__.update.call(this),l=this.particles[0],l.x=this.pos.x,l.y=this.pos.y,n=this.NUM_PARTICLES-1,g=0,p=[];for(h=o=n;n<=g?o<=g:o>=g;h=n<=g?++o:--o)l=this.particles[h],i=this.particles[h+1],m=this.particles[h-1],h===0?m=l:h===this.NUM_PARTICLES-1&&(i=l),l.vx*=this.DAMP,l.vy*=this.DAMP,l.x+=l.vx,l.y+=l.vy,j=l.x,k=l.y,e=l.x-m.x,f=l.y-m.y,d=e*e+f*f,d>this.DISTANCE_SQ?(a=atan2(f,e),l.x=m.x+this.DISTANCE*cos(a),l.y=m.y+this.DISTANCE*sin(a),c=.1,l.vx+=(l.x-j)*c,p.push(l.vy+=(l.y-k)*c)):p.push(void 0);return p},b.prototype.draw=function(){var a,b,c,d,e,f,g,h;this.ctx.beginPath(),this.ctx.arc(this.pos.x,this.pos.y,this.radius*.5,0,TWO_PI),this.ctx.fillStyle=this.color,this.ctx.fill(),this.ctx.beginPath();for(a=g=0,h=this.NUM_PARTICLES;0<=h?g<h:g>h;a=0<=h?++g:--g)e=this.particles[a],d=this.particles[a+1],f=this.particles[a-1],a===0?f=e:a===this.NUM_PARTICLES-1&&(d=e),b=e.x+(d.x-e.x)*.5,c=e.y+(d.y-e.y)*.5,this.ctx.quadraticCurveTo(e.x,e.y,b,c);return this.ctx.strokeStyle=this.color,this.ctx.lineWidth=1,this.ctx.stroke()},b.prototype.initParticles=function(){var a,b,c,d,e;e=[];for(a=c=0,d=this.NUM_PARTICLES;0<=d?c<d:c>d;a=0<=d?++c:--c)b={x:this.pos.x,y:this.pos.y,vx:0,vy:0,angle:0,thickness:0,mx:0,my:0,nx:0,ny:0},e.push(this.particles.push(b));return e},b.prototype.wrap=function(){var a,b,c,d,e,f,g,h,i;b=this.particles[this.particles.length-1],c=0,d=0,a=this.DISTANCE*2,e=!1,this.pos.x>this.ctx.width&&b.x>this.ctx.width?(this.pos.x=0,c=-a,e=!0):this.pos.x<0&&b.x<0&&(this.pos.x=this.ctx.width,c=a,e=!0),this.pos.y>this.ctx.height&&b.y>this.ctx.height?(this.pos.y=0,d=-a,e=!0):this.pos.y<0&&b.y<0&&(this.pos.y=this.ctx.height,d=a,e=!0);if(e){h=this.particles,i=[];for(f=0,g=h.length;f<g;f++)b=h[f],b.x=this.pos.x+c,i.push(b.y=this.pos.y+d);return i}},b}(d),window.app={view:null,init:function(){return app.initView(),app.view.init(),null},initView:function(){return app.view=new c,null},getParam:function(a){var b,c,d;return a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),c="[\\?&]"+a+"=([^&#]*)",b=new RegExp(c),d=b.exec(window.location.search),d?decodeURIComponent(d[1].replace(/\+/g," ")):""}},window.onload=function(){var a,b,c;if(window.FileReader)return a=function(a){return a.preventDefault&&a.preventDefault(),!1},c=function(a){var b,c,d,e,f,g;a.preventDefault&&a.preventDefault(),c=a.dataTransfer.files;for(d=f=0,g=c.length;0<=g?f<g:f>g;d=0<=g?++f:--f)b=c[d],e=new FileReader,e.onloadend=function(a){return app.view.image.src=a.target.result},e.readAsDataURL(b);return!1},b=document.getElementById("container"),b.ondragover=a,b.ondragenter=a,b.ondrop=c},app.init(),b=function(){function a(){}return a.getSeconds=function(a){var b,c;return a.indexOf(":")<0?0:(b=a.split(":"),b.length===3?c=+b[0]*60*60+ +b[1]*60+ +b[2]:b.length===2?c=+b[0]*60+ +b[1]:c=+b[0],c)},a.mercatorEncode=function(a,b,c){var d,e,f,g;return c==null&&(c=0),a=+a,b=b*Math.PI/180,c||(c=AppData.MAP_SIZE),e=d=c,f=e*(180+a)/360%e,g=Math.log(Math.tan(b*.5+Math.PI*.25)),g=d*.5-e*g/(2*Math.PI),[f,g]},a.getTrainLocationValue=function(a){var b;return b=0,a.indexOf("Between")===0&&(b=.5),b},a.getTrainLastStation=function(a){var b,c,d,e;return b=/Between\s(.+)\sand\s/,c=b.exec(a),c&&(e=c[1]),e||(b=/(At|Approaching|Left|)\s(.+)/,c=b.exec(a),c&&(e=c[2])),e?(d=app.stations.findWhere({name:e}),d?d.get("code"):console.log("AppUtils.getTrainLastStation : stationName "+e+" not found.")):null},a}(),e=function(){function a(){}return a.map=function(a,b,c,d,e,f,g,h){var i,j;return f==null&&(f=!1),g==null&&(g=!0),h==null&&(h=!0),g&&a<b?d:h&&a>c?e:(i=(a-b)/(c-b),j=i*(e-d)+d,f?Math.round(j):j)},a.hexToRgb=function(a){var b,c,d,e,f;return e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a),e?(d=parseInt(e[1],16),c=parseInt(e[2],16),b=parseInt(e[3],16),f=d+", "+c+", "+b,{r:d,g:c,b:b,rgb:f}):null},a.rgbToHex=function(a,b,c){return"#"+((1<<24)+(a<<16)+(b<<8)+c).toString(16).slice(1)},a}(),f=function(){function a(){}return a.loadJSON=function(a,b){var c;c=new XMLHttpRequest,c.overrideMimeType("application/json"),c.open("GET",a,!0),c.onreadystatechange=function(){c.readyState===4&&c.status==="200"&&b(c.responseText)},c.send(null)},a}(),h=function(){function a(){}return a.addLeadingZero=function(a,b){var c,d,e;b==null&&(b=1),d=String(a);for(c=e=0;0<=b?e<b:e>b;c=0<=b?++e:--e)a<Math.pow(10,c+1)&&a>-1&&(d="0"+d);return d},a.formatTime=function(a,b,c,d,e){var f,g,h,i,j;return b==null&&(b=!0),c==null&&(c=!0),d==null&&(d=!0),e==null&&(e=!1),i=Math.floor(a/1e3),h=Math.floor(i/60),g=Math.floor(h/60),f=Math.floor(a%1e3),j="",b&&(j+=this.addLeadingZero(g)),b&&c&&(j+=":"),c&&(j+=this.addLeadingZero(h%60)),c&&d&&(j+=":"),d&&(j+=this.addLeadingZero(i%60)),d&&e&&(j+="."),e&&(j+=this.addLeadingZero(f,2).substr(0,2)),j},a}()})).call(this)